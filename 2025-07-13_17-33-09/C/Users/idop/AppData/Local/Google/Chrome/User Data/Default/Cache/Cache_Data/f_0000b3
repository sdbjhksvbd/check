!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SplunkAnalytics",[],t):"object"==typeof exports?exports.SplunkAnalytics=t():e.SplunkAnalytics=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"logger",(function(){return u})),n.d(t,"service",(function(){return y}));var r={error:[],info:[],debug:[]},o="error",i="info",a=function(e,t){window.sp&&window.sp.log?sp.log[e](t):r[e].push(t)},u={info:function(e){a(i,e)},error:function(e){a(o,e)},debug:function(e){a(i,e)},flush:function(){window.sp&&window.sp.log?(r.error.length>0&&(sp.log.error(r.error),r.error=[]),r.info.length>0&&(sp.log.info(r.info),r.info=[]),r.debug.length>0&&(sp.log.debug(r.debug),r.debug=[])):console.log("sp.js not loaded yet")}},c={tag_url:"/api/v2/analytics/tag",apix_tag_url:"/v2/tag",app_name_msg:"Invalid application name. Accepts only alphabets, numbers, underscore and hyphen characters. First character must an alphabet. Length must be between 3 to 50 characters."},l={setWithExpiry:function(e,t,n,r){var o={value:t,expiry:(new Date).getTime()+n,version:r};return localStorage.setItem(e,JSON.stringify(o)),Promise.resolve(t)},getWithExpiry:function(e,t){var n=localStorage.getItem(e);return new Promise((function(r){if(!n)return r(null);var o=JSON.parse(n);return o.version&&o.version!==t?r(null):(new Date).getTime()>o.expiry?(localStorage.removeItem(e),r(null)):r(o.value)}))}};function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g="is_logging_enabled",y={isValidAppName:function(e){return/^[a-z][a-z0-9\-_]{2,49}$/.test(e.trim().toLowerCase())},getAppDetails:function(e,t){if(!this.isValidAppName(t))return Promise.reject(new Error(c.app_name_msg));var n=c.tag_url;return-1!==e.indexOf("apps-api.splunk.com")&&(n=c.apix_tag_url),l.getWithExpiry(t,2).then((function(r){return null===r?fetch(e+n,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t}),credentials:"include"}).then((function(e){if(e.ok)return e.json();throw new Error("Failed to retrieve application details")})):f(f({},r),{},{cached:!0})})).then((function(e){return e.cached?e:l.setWithExpiry(t,e,2592e6,2)})).then((function(e){var t=!(!e||!e.data)&&e.data;return t&&t.isLoggingEnabled?localStorage.setItem(g,t.isLoggingEnabled):localStorage.removeItem(g),t}))},addScript:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"head",n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((function(o){var i=document.querySelector(t);window.scriptLoaded=function(){console.log("Script loaded!"),u.flush(),o()};var a=document.createElement("script");a.setAttribute("type","text/javascript"),e+="loadScript = scriptLoaded",a.text=e,a.async=void 0===n||n,a.defer=void 0===r||r,i.appendChild(a)}))},track:function(e,t){var n={svp:e.svp,elinkid:e.elinkid,el:e.el,ec:e.ec,eht:e.eht,ea:e.ea,e0:e.e0,e1:e.e1,e2:e.e2,e3:e.e3,e4:e.e4,e5:e.e5,e6:e.e6,e7:e.e7,e8:e.e8,e9:e.e9,a0:e.a0,a1:e.a1,a2:e.a2,a3:e.a3,a4:e.a4,a5:e.a5,a6:e.a6,a7:e.a7,a8:e.a8,a9:e.a9,u0:e.u0,u1:e.u1,u2:e.u2,u3:e.u3,u4:e.u4,u5:e.u5,u6:e.u6,u7:e.u7,u8:e.u8,u9:e.u9},r=e.user;if(t&&r){var o={uid:r.uid,uname:r.uname};n=f(f({},n),o)}window.sp?window.sp.track("track",n):console.log("SplunkAnalytics::ERROR: sp object not found. Unable to track events.")},pageview:function(e){window.sp?window.sp.pageview(e):console.log("SplunkAnalytics::ERROR: sp object not found. Unable to track events.")}}}])}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9TcGx1bmtBbmFseXRpY3Mvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL1NwbHVua0FuYWx5dGljcy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9TcGx1bmtBbmFseXRpY3MvLi9zcmMvc2VydmljZXMvbG9nZ2VyU2VydmljZS5qcyIsIndlYnBhY2s6Ly9TcGx1bmtBbmFseXRpY3MvLi9zcmMvY29uc3RhbnRzL2FuYWx5dGljcy5qcyIsIndlYnBhY2s6Ly9TcGx1bmtBbmFseXRpY3MvLi9zcmMvc2VydmljZXMvY2FjaGVTZXJ2aWNlLmpzIiwid2VicGFjazovL1NwbHVua0FuYWx5dGljcy8uL3NyYy9zZXJ2aWNlcy9hbmFseXRpY3NTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInNlbGYiLCJ0aGlzIiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImxvZ3MiLCJlcnJvciIsImluZm8iLCJkZWJ1ZyIsInR5cGVzIiwibG9nZ2VyIiwidHlwZSIsImRhdGEiLCJ3aW5kb3ciLCJzcCIsImxvZyIsInB1c2giLCJmdW5jdGlvbnMiLCJmbHVzaCIsImxlbmd0aCIsImNvbnNvbGUiLCJ0YWdfdXJsIiwiYXBpeF90YWdfdXJsIiwiYXBwX25hbWVfbXNnIiwic2V0V2l0aEV4cGlyeSIsInR0bCIsImNhY2hlVmVyc2lvbiIsIml0ZW0iLCJleHBpcnkiLCJEYXRlIiwiZ2V0VGltZSIsInZlcnNpb24iLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsIlByb21pc2UiLCJyZXNvbHZlIiwiZ2V0V2l0aEV4cGlyeSIsIml0ZW1TdHIiLCJnZXRJdGVtIiwicGFyc2UiLCJyZW1vdmVJdGVtIiwiaXNWYWxpZEFwcE5hbWUiLCJ0ZXN0IiwidHJpbSIsInRvTG93ZXJDYXNlIiwiZ2V0QXBwRGV0YWlscyIsImFuYWx5dGljc0hvc3QiLCJhcHBsaWNhdGlvbk5hbWUiLCJyZWplY3QiLCJFcnJvciIsImNvbmZpZyIsInRhZyIsImluZGV4T2YiLCJjYWNoZVNlcnZpY2UiLCJ0aGVuIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsImNyZWRlbnRpYWxzIiwicmVzIiwib2siLCJqc29uIiwiX29iamVjdFNwcmVhZCIsImNhY2hlZCIsInJlc3VsdCIsImlzTG9nZ2luZ0VuYWJsZWQiLCJhZGRTY3JpcHQiLCJzcmMiLCJwb3NpdGlvbiIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsImFzeW5jIiwiZGVmZXIiLCJwbGFjZW1lbnQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzY3JpcHRMb2FkZWQiLCJzY3JpcHQiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwidGV4dCIsImFwcGVuZENoaWxkIiwidHJhY2siLCJvcHRpb25zIiwiaXNMb2dnZWRJbiIsInBhcmFtcyIsInN2cCIsImVsaW5raWQiLCJlbCIsImVjIiwiZWh0IiwiZWEiLCJlMCIsImUxIiwiZTIiLCJlMyIsImU0IiwiZTUiLCJlNiIsImU3IiwiZTgiLCJlOSIsImEwIiwiYTEiLCJhMiIsImEzIiwiYTQiLCJhNSIsImE2IiwiYTciLCJhOCIsImE5IiwidTAiLCJ1MSIsInUyIiwidTMiLCJ1NCIsInU1IiwidTYiLCJ1NyIsInU4Iiwi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SUlDLEdBSDFEbEMsRUFEMERrQyxHQUlJQyxHQUg5RG5DLEVBRDhEbUMsR0FJSUMsR0FIbEVwQyxFQURrRW9DLEdBSUlDLEdBSHRFckMsRUFEc0VxQyxHQUlJQyxHQUgxRXRDLEVBRDBFc0MsSUFNdEVDLEVBQVN2QyxFQUFUdUMsS0FDUixHQUFJdEMsR0FBY3NDLEVBQU0sQ0FDdEIsSUFBTUMsRUFBaUIsQ0FBRUMsSUFBS0YsRUFBS0UsSUFBS0MsTUFBT0gsRUFBS0csT0FDcER4QyxFQUFNdkIsSUFBQSxHQUNEdUIsR0FDQXNDLEdBR0hqSCxPQUFPQyxHQUNURCxPQUFPQyxHQUFHdUUsTUFBTSxRQUFTRyxHQUV6QnBFLFFBQVFMLElBQUkseUVBUWhCa0gsU0FBUSxTQUFDQyxHQUNIckgsT0FBT0MsR0FDVEQsT0FBT0MsR0FBR21ILFNBQVNDLEdBRW5COUcsUUFBUUwsSUFBSSIsImZpbGUiOiJAc3BsdW5rLWl0ZW5nL3NwbHVuay1hbmFseXRpY3MubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgPT09ICdvYmplY3QnKVxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHRlbHNlIGlmKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZClcblx0XHRkZWZpbmUoXCJTcGx1bmtBbmFseXRpY3NcIiwgW10sIGZhY3RvcnkpO1xuXHRlbHNlIGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jylcblx0XHRleHBvcnRzW1wiU3BsdW5rQW5hbHl0aWNzXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIlNwbHVua0FuYWx5dGljc1wiXSA9IGZhY3RvcnkoKTtcbn0pKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgOiB0aGlzLCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJsZXQgbG9ncyA9IHtcbiAgZXJyb3I6IFtdLFxuICBpbmZvOiBbXSxcbiAgZGVidWc6IFtdXG59O1xuY29uc3QgdHlwZXMgPSB7XG4gIGVycm9yOiAnZXJyb3InLFxuICBpbmZvOiAnaW5mbycsXG4gIGRlYnVnOiAnZGVidWcnXG59O1xubGV0IGxvZ2dlciA9ICh0eXBlLCBkYXRhKSA9PiB7XG4gIGlmICghd2luZG93LnNwIHx8ICF3aW5kb3cuc3AubG9nKSB7XG4gICAgbG9nc1t0eXBlXS5wdXNoKGRhdGEpO1xuICAgIHJldHVybjtcbiAgfVxuICBzcC5sb2dbdHlwZV0oZGF0YSk7XG59O1xuY29uc3QgZnVuY3Rpb25zID0ge1xuICBpbmZvOiAoZGF0YSkgPT4ge1xuICAgIGxvZ2dlcih0eXBlcy5pbmZvLCBkYXRhKTtcbiAgfSxcbiAgZXJyb3I6IChkYXRhKSA9PiB7XG4gICAgbG9nZ2VyKHR5cGVzLmVycm9yLCBkYXRhKTtcbiAgfSxcbiAgZGVidWc6IChkYXRhKSA9PiB7XG4gICAgbG9nZ2VyKHR5cGVzLmluZm8sIGRhdGEpO1xuICB9LFxuICBmbHVzaDogKCkgPT4ge1xuICAgIGlmICghd2luZG93LnNwIHx8ICF3aW5kb3cuc3AubG9nKSB7XG4gICAgICBjb25zb2xlLmxvZygnc3AuanMgbm90IGxvYWRlZCB5ZXQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGxvZ3MuZXJyb3IubGVuZ3RoID4gMCkge1xuICAgICAgc3AubG9nLmVycm9yKGxvZ3MuZXJyb3IpO1xuICAgICAgbG9ncy5lcnJvciA9IFtdO1xuICAgIH1cbiAgICBpZiAobG9ncy5pbmZvLmxlbmd0aCA+IDApIHtcbiAgICAgIHNwLmxvZy5pbmZvKGxvZ3MuaW5mbyk7XG4gICAgICBsb2dzLmluZm8gPSBbXTtcbiAgICB9XG4gICAgaWYgKGxvZ3MuZGVidWcubGVuZ3RoID4gMCkge1xuICAgICAgc3AubG9nLmRlYnVnKGxvZ3MuZGVidWcpO1xuICAgICAgbG9ncy5kZWJ1ZyA9IFtdO1xuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb25zO1xuIiwiZXhwb3J0IGRlZmF1bHQge1xuICBhbmFseXRpY3M6IHtcbiAgICB0YWdfdXJsOiAnL2FwaS92Mi9hbmFseXRpY3MvdGFnJyxcbiAgICBhcGl4X3RhZ191cmw6ICcvdjIvdGFnJyxcbiAgICBhcHBfbmFtZV9tc2c6ICdJbnZhbGlkIGFwcGxpY2F0aW9uIG5hbWUuIEFjY2VwdHMgb25seSBhbHBoYWJldHMsIG51bWJlcnMsIHVuZGVyc2NvcmUgYW5kIGh5cGhlbiBjaGFyYWN0ZXJzLiAnICtcbiAgICAgICdGaXJzdCBjaGFyYWN0ZXIgbXVzdCBhbiBhbHBoYWJldC4gTGVuZ3RoIG11c3QgYmUgYmV0d2VlbiAzIHRvIDUwIGNoYXJhY3RlcnMuJ1xuICB9XG59O1xuIiwiY29uc3QgZnVuY3Rpb25zID0ge1xuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGtleSAgICAgLSBzdG9yYWdlIGtleVxuICAgKiBAcGFyYW0gdmFsdWUgICAtIHN0b3JhZ2UgdmFsdWVcbiAgICogQHBhcmFtIHR0bCAgICAgLSB0dGwgb2YgZGF0YSBiZWluZyBzdG9yZWRcbiAgICogQHBhcmFtIGNhY2hlVmVyc2lvbiAtIGNhY2hlIHZlcnNpb24gKHRoaXMgaGVscHMgdG8gaW52YWxpZGF0ZSBkYXRhIHRoYXQgbmVlZHMgdG8gYmUgY2hhbmdlZClcbiAgICogQHJldHVybiB7UHJvbWlzZTwqPn1cbiAgICovXG4gIHNldFdpdGhFeHBpcnk6IChrZXksIHZhbHVlLCB0dGwsIGNhY2hlVmVyc2lvbikgPT4ge1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAvLyBgaXRlbWAgaXMgYW4gb2JqZWN0IHdoaWNoIGNvbnRhaW5zIHRoZSBvcmlnaW5hbCB2YWx1ZVxuICAgIC8vIGFzIHdlbGwgYXMgdGhlIHRpbWUgd2hlbiBpdCdzIHN1cHBvc2VkIHRvIGV4cGlyZVxuICAgIGNvbnN0IGl0ZW0gPSB7XG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBleHBpcnk6IG5vdy5nZXRUaW1lKCkgKyB0dGwsXG4gICAgICB2ZXJzaW9uOiBjYWNoZVZlcnNpb25cbiAgICB9O1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkoaXRlbSkpO1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodmFsdWUpO1xuICB9LFxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGtleSAgICAgICAgICAgLSBzdG9yYWdlIGtleVxuICAgKiBAcGFyYW0gY2FjaGVWZXJzaW9uICAtIGNhY2hlIHZlcnNpb24gKHRoaXMgaGVscHMgdG8gaW52YWxpZGF0ZSBkYXRhIHRoYXQgbmVlZHMgdG8gYmUgY2hhbmdlZClcbiAgICogQHJldHVybiB7UHJvbWlzZTwqPn1cbiAgICovXG4gIGdldFdpdGhFeHBpcnk6IChrZXksIGNhY2hlVmVyc2lvbikgPT4ge1xuICAgIGNvbnN0IGl0ZW1TdHIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICAvLyBpZiB0aGUgaXRlbSBkb2Vzbid0IGV4aXN0LCByZXR1cm4gbnVsbFxuICAgICAgaWYgKCFpdGVtU3RyKSB7XG4gICAgICAgIHJldHVybiByZXNvbHZlKG51bGwpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpdGVtID0gSlNPTi5wYXJzZShpdGVtU3RyKTtcblxuICAgICAgLy8gdmVyc2lvbiBmbGFnIGFsbG93c1xuICAgICAgaWYgKGl0ZW0udmVyc2lvbiAmJiBpdGVtLnZlcnNpb24gIT09IGNhY2hlVmVyc2lvbikge1xuICAgICAgICByZXR1cm4gcmVzb2x2ZShudWxsKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcblxuICAgICAgLy8gY29tcGFyZSB0aGUgZXhwaXJ5IHRpbWUgb2YgdGhlIGl0ZW0gd2l0aCB0aGUgY3VycmVudCB0aW1lXG4gICAgICBpZiAobm93LmdldFRpbWUoKSA+IGl0ZW0uZXhwaXJ5KSB7XG4gICAgICAgIC8vIElmIHRoZSBpdGVtIGlzIGV4cGlyZWQsIGRlbGV0ZSB0aGUgaXRlbSBmcm9tIHN0b3JhZ2VcbiAgICAgICAgLy8gYW5kIHJldHVybiBudWxsXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgICAgIHJldHVybiByZXNvbHZlKG51bGwpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc29sdmUoaXRlbS52YWx1ZSk7XG4gICAgfSk7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9ucztcbiIsImltcG9ydCBjb25maWcgZnJvbSAnLi4vY29uc3RhbnRzL2FuYWx5dGljcyc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyU2VydmljZSc7XG5pbXBvcnQgY2FjaGVTZXJ2aWNlIGZyb20gJy4vY2FjaGVTZXJ2aWNlJztcblxuY29uc3Qga2V5ID0gJ2lzX2xvZ2dpbmdfZW5hYmxlZCc7XG5jb25zdCBkYXlzSW5NaWxsaSA9IDg2NDAwMDAwICogMzA7XG5jb25zdCBjYWNoZVZlcnNpb24gPSAyO1xuY29uc3QgZnVuY3Rpb25zID0ge1xuICAvKipcbiAgICogVG8gdmFsaWRhdGUgYXBwbGljYXRpb24gbmFtZVxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICAgKi9cbiAgaXNWYWxpZEFwcE5hbWUobmFtZSkge1xuICAgIHJldHVybiAvXlthLXpdW2EtejAtOVxcLV9dezIsNDl9JC8udGVzdChuYW1lLnRyaW0oKS50b0xvd2VyQ2FzZSgpKTtcbiAgfSxcblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gQXBwRGV0YWlsc1xuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IGlzTG9nZ2luZ0VuYWJsZWRcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IGFwcGxpY2F0aW9uSWRcbiAgICogQHByb3BlcnR5IHtzdHJpbmd9IHNjcmlwdFxuICAgKi9cblxuICAvKipcbiAgICogVG8gZ2V0IGFwcGxpY2F0aW9uIGRldGFpbHNcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFuYWx5dGljc0hvc3RcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcGxpY2F0aW9uTmFtZVxuICAgKiBAcmV0dXJuIHtQcm9taXNlPEFwcERldGFpbHM+fSByZXN1bHRcbiAgICovXG4gIGdldEFwcERldGFpbHMoYW5hbHl0aWNzSG9zdCwgYXBwbGljYXRpb25OYW1lKSB7XG4gICAgY29uc3QgaXNWYWxpZCA9IHRoaXMuaXNWYWxpZEFwcE5hbWUoYXBwbGljYXRpb25OYW1lKTtcblxuICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihjb25maWcuYW5hbHl0aWNzLmFwcF9uYW1lX21zZykpO1xuICAgIH1cblxuICAgIC8vVE9ETyA6IENvZGUgdG8gYmUgcmVmYWN0b3JlZCBpbiB0aGUgZnV0dXJlIHRvIG9ubHkgc3VwcG9ydCBBUElYQ0hBTkdFICFcbiAgICBsZXQgdGFnID0gY29uZmlnLmFuYWx5dGljcy50YWdfdXJsO1xuICAgIGlmIChhbmFseXRpY3NIb3N0LmluZGV4T2YoJ2FwcHMtYXBpLnNwbHVuay5jb20nKSAhPT0gLTEpIHtcbiAgICAgIHRhZyA9IGNvbmZpZy5hbmFseXRpY3MuYXBpeF90YWdfdXJsO1xuICAgIH1cblxuICAgIHJldHVybiBjYWNoZVNlcnZpY2UuZ2V0V2l0aEV4cGlyeShhcHBsaWNhdGlvbk5hbWUsIGNhY2hlVmVyc2lvbilcbiAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICBpZiAoZGF0YSA9PT0gbnVsbCkge1xuICAgICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9GZXRjaF9BUEkvVXNpbmdfRmV0Y2hcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJvbWlzZS9uby1uZXN0aW5nXG4gICAgICAgICAgcmV0dXJuIGZldGNoKGFuYWx5dGljc0hvc3QgKyB0YWcsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYXBwbGljYXRpb25OYW1lXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnXG4gICAgICAgICAgICB9KS50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcmV0cmlldmUgYXBwbGljYXRpb24gZGV0YWlscycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB7IC4uLmRhdGEsIGNhY2hlZDogdHJ1ZSB9O1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIGlmICghZGF0YS5jYWNoZWQpIHtcbiAgICAgICAgICByZXR1cm4gY2FjaGVTZXJ2aWNlLnNldFdpdGhFeHBpcnkoYXBwbGljYXRpb25OYW1lLCBkYXRhLCBkYXlzSW5NaWxsaSwgY2FjaGVWZXJzaW9uKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXMgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSByZXMgJiYgcmVzLmRhdGEgPyByZXMuZGF0YSA6IGZhbHNlO1xuICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5pc0xvZ2dpbmdFbmFibGVkKSB7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCByZXN1bHQuaXNMb2dnaW5nRW5hYmxlZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFRvIGFkZCBhIHNwLmpzIHNjcmlwdFxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gICAgICBzcmNcbiAgICogQHBhcmFtIHtzdHJpbmd9ICAgICAgcG9zaXRpb24gKGhlYWQvYm9keSlcbiAgICogQHBhcmFtIHtib29sZWFufSAgICAgYXN5bmNcbiAgICogQHBhcmFtIHtib29sZWFufSAgICAgZGVmZXJcbiAgICovXG4gIGFkZFNjcmlwdChzcmMsIHBvc2l0aW9uID0gJ2hlYWQnLCBhc3luYywgZGVmZXIpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcbiAgICAgIGNvbnN0IHBsYWNlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9zaXRpb24pO1xuICAgICAgd2luZG93LnNjcmlwdExvYWRlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1NjcmlwdCBsb2FkZWQhJyk7XG4gICAgICAgIGxvZ2dlci5mbHVzaCgpO1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuICAgICAgbGV0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgc2NyaXB0LnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0L2phdmFzY3JpcHQnKTtcbiAgICAgIHNyYyArPSAnbG9hZFNjcmlwdCA9IHNjcmlwdExvYWRlZCc7XG4gICAgICBzY3JpcHQudGV4dCA9IHNyYztcbiAgICAgIHNjcmlwdC5hc3luYyA9ICh0eXBlb2YgYXN5bmMgPT09ICd1bmRlZmluZWQnID8gdHJ1ZSA6IGFzeW5jKTtcbiAgICAgIHNjcmlwdC5kZWZlciA9ICh0eXBlb2YgZGVmZXIgPT09ICd1bmRlZmluZWQnID8gdHJ1ZSA6IGRlZmVyKTtcbiAgICAgIHBsYWNlbWVudC5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBUbyB0cmFjayBhbmFseXRpY3MgZGF0YVxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gb3B0aW9uc1xuICAgKiBAcGFyYW0ge2Jvb2xlYW59IGlzTG9nZ2VkSW5cbiAgICovXG4gIHRyYWNrKG9wdGlvbnMsIGlzTG9nZ2VkSW4pIHtcbiAgICBjb25zdCB7XG4gICAgICBzdnAsIGVsaW5raWQsIGVsLCBlYywgZWh0LCBlYSwgZTAsIGUxLCBlMiwgZTMsIGU0LCBlNSwgZTYsIGU3LCBlOCwgZTksXG4gICAgICBhMCwgYTEsIGEyLCBhMywgYTQsIGE1LCBhNiwgYTcsIGE4LCBhOSwgdTAsIHUxLCB1MiwgdTMsIHU0LCB1NSwgdTYsIHU3LCB1OCwgdTlcbiAgICB9ID0gb3B0aW9ucztcbiAgICBsZXQgcGFyYW1zID0ge1xuICAgICAgc3ZwLCBlbGlua2lkLCBlbCwgZWMsIGVodCwgZWEsIGUwLCBlMSwgZTIsIGUzLCBlNCwgZTUsIGU2LCBlNywgZTgsIGU5LFxuICAgICAgYTAsIGExLCBhMiwgYTMsIGE0LCBhNSwgYTYsIGE3LCBhOCwgYTksIHUwLCB1MSwgdTIsIHUzLCB1NCwgdTUsIHU2LCB1NywgdTgsIHU5XG4gICAgfTtcbiAgICBjb25zdCB7IHVzZXIgfSA9IG9wdGlvbnM7XG4gICAgaWYgKGlzTG9nZ2VkSW4gJiYgdXNlcikge1xuICAgICAgY29uc3QgbG9nZ2VkSW5QYXJhbXMgPSB7IHVpZDogdXNlci51aWQsIHVuYW1lOiB1c2VyLnVuYW1lIH07XG4gICAgICBwYXJhbXMgPSB7XG4gICAgICAgIC4uLnBhcmFtcyxcbiAgICAgICAgLi4ubG9nZ2VkSW5QYXJhbXNcbiAgICAgIH07XG4gICAgfVxuICAgIGlmICh3aW5kb3cuc3ApIHtcbiAgICAgIHdpbmRvdy5zcC50cmFjaygndHJhY2snLCBwYXJhbXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZygnU3BsdW5rQW5hbHl0aWNzOjpFUlJPUjogc3Agb2JqZWN0IG5vdCBmb3VuZC4gVW5hYmxlIHRvIHRyYWNrIGV2ZW50cy4nKTtcbiAgICB9XG4gIH0sXG4gIC8qKlxuICAgKiBUcmlnZ2VyIHBhZ2Ugdmlld1xuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsXG4gICAqL1xuICBwYWdldmlldyh1cmwpIHtcbiAgICBpZiAod2luZG93LnNwKSB7XG4gICAgICB3aW5kb3cuc3AucGFnZXZpZXcodXJsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coJ1NwbHVua0FuYWx5dGljczo6RVJST1I6IHNwIG9iamVjdCBub3QgZm91bmQuIFVuYWJsZSB0byB0cmFjayBldmVudHMuJyk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbnM7XG4iXSwic291cmNlUm9vdCI6IiJ9