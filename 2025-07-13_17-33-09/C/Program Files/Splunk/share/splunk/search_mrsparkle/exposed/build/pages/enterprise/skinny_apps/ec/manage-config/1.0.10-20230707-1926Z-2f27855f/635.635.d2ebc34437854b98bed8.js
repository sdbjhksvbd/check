/*! For license information please see 635.635.d2ebc34437854b98bed8.js.LICENSE.txt */
(self.webpackChunkremote_manage_config_page=self.webpackChunkremote_manage_config_page||[]).push([[635],{33518:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>q});var r=n(30168),a=n(12650),s=n.n(a),o=n(6472),i=n.n(o),c=n(66206),l=n.n(c),p=n(25947),d=n(97212),m=n(95414),_=n.n(m),T=n(97026),u=n.n(T),L=n(96486),E=n(84711),h=(n(83361),n(39839));const I="ip-address",A={[I]:e=>{const{isValid:t}=(0,h.cy)(e);return t}},O={type:"object",properties:{"search-api":{type:"array",items:{type:"string",format:I}},hec:{type:"array",items:{type:"string",format:I}},s2s:{type:"array",items:{type:"string",format:I}},"search-ui":{type:"array",items:{type:"string",format:I}},"idm-ui":{type:"array",items:{type:"string",format:I}},"idm-api":{type:"array",items:{type:"string",format:I}}}};var N=n(79674),y=n(7416);const S={schema:O,uischema:{type:"TabBar",elements:[{type:"Category",label:N.X.IP_ALLOW_LIST.TAB_NAMES[y.T.HEC],elements:[{type:"HorizontalLayout",elements:[{type:"FormRows",scope:"#/properties/hec",options:{customComponentProps:{validators:[h.cy],placeholder:["192.0.0.0/24"],labelsForScreenReader:["Subnet record"],deleteConfirmationModal:{title:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_TITLE,content:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_CONTENT}},suiComponentProps:{addLabel:N.X.IP_ALLOW_LIST.ADD_SUBNET_BTN_LABEL}}},{type:"HorizontalLayout",elements:[]}]}]},{type:"Category",label:N.X.IP_ALLOW_LIST.TAB_NAMES[y.T.S2S],elements:[{type:"HorizontalLayout",elements:[{type:"FormRows",scope:"#/properties/s2s",options:{customComponentProps:{validators:[h.cy],placeholder:["192.0.0.0/24"],labelsForScreenReader:["Subnet record"],deleteConfirmationModal:{title:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_TITLE,content:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_CONTENT}},suiComponentProps:{addLabel:N.X.IP_ALLOW_LIST.ADD_SUBNET_BTN_LABEL}}},{type:"HorizontalLayout",elements:[]}]}]},{type:"Category",label:N.X.IP_ALLOW_LIST.TAB_NAMES[y.T.SearchAPI],elements:[{type:"HorizontalLayout",elements:[{type:"FormRows",scope:"#/properties/search-api",options:{customComponentProps:{validators:[h.cy],placeholder:["192.0.0.0/24"],labelsForScreenReader:["Subnet record"],deleteConfirmationModal:{title:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_TITLE,content:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_CONTENT}},suiComponentProps:{addLabel:N.X.IP_ALLOW_LIST.ADD_SUBNET_BTN_LABEL}}},{type:"HorizontalLayout",elements:[]}]}]},{type:"Category",label:N.X.IP_ALLOW_LIST.TAB_NAMES[y.T.IDMAPI],elements:[{type:"HorizontalLayout",elements:[{type:"FormRows",scope:"#/properties/idm-api",options:{customComponentProps:{validators:[h.cy],placeholder:["192.0.0.0/24"],labelsForScreenReader:["Subnet record"],deleteConfirmationModal:{title:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_TITLE,content:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_CONTENT}},suiComponentProps:{addLabel:N.X.IP_ALLOW_LIST.ADD_SUBNET_BTN_LABEL}}},{type:"HorizontalLayout",elements:[]}]}]},{type:"Category",label:N.X.IP_ALLOW_LIST.TAB_NAMES[y.T.IDMUI],elements:[{type:"HorizontalLayout",elements:[{type:"FormRows",scope:"#/properties/idm-ui",options:{customComponentProps:{validators:[h.cy],placeholder:["192.0.0.0/24"],labelsForScreenReader:["Subnet record"],deleteConfirmationModal:{title:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_TITLE,content:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_CONTENT}},suiComponentProps:{addLabel:N.X.IP_ALLOW_LIST.ADD_SUBNET_BTN_LABEL}}},{type:"HorizontalLayout",elements:[]}]}]},{type:"Category",label:N.X.IP_ALLOW_LIST.TAB_NAMES[y.T.SearchUI],elements:[{type:"HorizontalLayout",elements:[{type:"FormRows",scope:"#/properties/search-ui",options:{customComponentProps:{validators:[h.cy],placeholder:["192.0.0.0/24"],labelsForScreenReader:["Subnet record"],deleteConfirmationModal:{title:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_TITLE,content:N.X.IP_ALLOW_LIST.DELETE_CONFIRMATION_MODAL_CONTENT}},suiComponentProps:{addLabel:N.X.IP_ALLOW_LIST.ADD_SUBNET_BTN_LABEL}}},{type:"HorizontalLayout",elements:[]}]}]}]}};var g=n(88100),C=n(16573),R=n(25108);const f=[y.T.HEC,y.T.S2S,y.T.SearchAPI,y.T.SearchUI,y.T.IDMAPI,y.T.IDMUI],w=e=>C.K.getACSBaseURL()+"/access/"+e+"/ipallowlists",D=async e=>{if(200!==e.status){const t=await e.json();throw new Error(t.message)}try{const t=await e.text();return""===t?{}:JSON.parse(t)}catch(e){throw new Error(e.message)}},b=async e=>{const{feature:t,method:n,subnets:r}=e,a=JSON.stringify({subnets:r});try{const e=await C.K.withJwtTokenRetry((()=>fetch(w(t),{method:n,headers:C.K.getACSHeaders(),body:a})));return await D(e)}catch(e){throw R.log(e),e}};let P=f.reduce(((e,t,n)=>(e[f[n]]=[],e)),{});const v=e=>{let{prevSubnets:t,currSubnets:n}=e;return{added:(0,L.difference)(n,t),removed:(0,L.difference)(t,n)}},k=e=>e.map((e=>"rejected"===e.status?e.reason.message:"")),M=async()=>{const e=await Promise.allSettled(f.map((e=>(async e=>{const{feature:t}=e;try{const e=await C.K.withJwtTokenRetry((()=>fetch(w(t),{headers:C.K.getACSHeaders()})));return(e=>{const t=e;return t.subnets=e.subnets.filter((e=>0!==e.indexOf("sg-"))),t})(await D(e))}catch(e){throw new Error(e.message)}})({feature:e})))),t=e.reduce(((e,t,n)=>(e[f[n]]="fulfilled"===t.status?(t.value.subnets||[]).sort():P[f[n]],e)),{});return P=t,{records:P,error:k(e)}};var U=n(93379),B=n.n(U),X=n(33187);B()(X.Z,{insert:"head",singleton:!1}),X.Z.locals;var Z=n(2249),H=n(66070);const F={CONTAINER:"Container",LEARN_MORE_LINK:"LearnmoreLink",WAITSPINNER:"Waitspinner"};(0,Z.normalizeDataTestIds)({remoteAppName:H.KH,compName:"IPAllowList",testIds:F});const W=F;var K,j,x=n(82269),z=n(72361);const J=u().div(K||(K=(0,r.Z)(["\n    max-width: 960px;\n    padding: 30px 20px 20px 20px;\n    background-color: ",";\n    box-shadow: ",";\n    margin: 0 auto 20px;\n    display: flex;\n    flex-direction: column;\n"])),(0,p.pick)({enterprise:p.variables.backgroundColor,prisma:p.variables.backgroundColorPopup}),p.variables.overlayShadow),V=u().div(j||(j=(0,r.Z)(["\n    display: flex;\n    justify-content: center;\n    margin-top: 40px;\n    margin-bottom: 40px;\n"]))),q=(0,L.flowRight)([(0,z.ao)(["cloud"]),(0,z.Bv)(["edit_ip_allow_list"])])((()=>{const[e,t]=(0,a.useState)(),[n,r]=(0,a.useState)({}),[c,p]=(0,a.useState)(!0),[m,T]=(0,a.useState)([]),[u,I]=(0,a.useState)(!1),O=function(e){void 0===e&&(e=[]);const t=[];return e.forEach(((e,n)=>{e&&t.push({key:N.X.IP_ALLOW_LIST.TAB_NAMES[f[n]],value:(0,L.upperFirst)(e)})})),t};return(0,a.useEffect)((()=>{const e=async()=>{t(await(async()=>Promise.resolve(S))())},n=async()=>{const{records:e,error:t}=await M();r(e),T(O(t))};(async()=>{try{await C.K.init("v1"),I(!0),await Promise.all([e(),n()])}catch(e){new Set([x.Z.STACK_ID_INVALID,x.Z.ACS_ENVIRONMENT_NOT_FOUND,x.Z.CANNOT_CREATE_JWT_TOKEN]).has(e.message)?(I(!0),T([N.X.USER_CONTEXT.ERRORS[e.message]])):e.message===x.Z.TOKEN_AUTH_DISABLED?I(!1):T([e.message])}finally{p(!1)}})()}),[]),s().createElement(s().Fragment,null,u&&!c&&s().createElement(J,{"data-test":W.CONTAINER},s().createElement("p",null,N.X.IP_ALLOW_LIST.DESCRIPTION," ",s().createElement(l(),{to:(0,d.createDocsURL)("learnmore.ip_allow_list_ui"),openInNewContext:!0,"data-test-name":W.LEARN_MORE_LINK},N.X.COMMON.LEARN_MORE)),m.length>0&&s().createElement(o.Errors,{errorMessages:m}),!m.length&&s().createElement(i(),{schema:e.schema,uischema:e.uischema,data:n,onChange:()=>{},onSubmit:async e=>{let{data:t,successCb:n,failureCb:a}=e;const{records:s,error:o=[]}=await(async e=>{const t=[],n={};let r=!1;for(let a=0;a<f.length;a+=1){const s=P[f[a]],o=e[f[a]],{added:i,removed:c}=v({prevSubnets:s,currSubnets:o});i.length||c.length?i.length&&c.length?(r=!0,(0,L.set)(n,f[a]+".request.add",i.length),t.push(b({feature:f[a],method:"post",subnets:i}).then((async()=>{(0,L.set)(n,f[a]+".response.added",i.length),(0,L.set)(n,f[a]+".request.remove",c.length);try{const e=await b({feature:f[a],method:"delete",subnets:c});return(0,L.set)(n,f[a]+".response.removed",c.length),e}catch(e){return(0,L.set)(n,f[a]+".response.removed",0),e}})).catch((e=>((0,L.set)(n,f[a]+".response.added",0),Promise.reject(e)))))):i.length?(r=!0,(0,L.set)(n,f[a]+".request.add",i.length),t.push(b({feature:f[a],method:"post",subnets:i}).then((e=>((0,L.set)(n,f[a]+".response.added",i.length),e))).catch((e=>((0,L.set)(n,f[a]+".response.added",0),Promise.reject(e)))))):c.length&&(r=!0,(0,L.set)(n,f[a]+".request.remove",c.length),t.push(b({feature:f[a],method:"delete",subnets:c}).then((e=>((0,L.set)(n,f[a]+".response.removed",c.length),e))).catch((e=>((0,L.set)(n,f[a]+".response.removed",0),Promise.reject(e)))))):t.push(Promise.resolve({}))}if(!r)return{};const a=await Promise.allSettled(t);g.TrackingService.trackEvent({type:"manageConfigPage.submitBtnClicked",data:n});const s=k(a);if((0,h.Wl)(s).length){const e=[];s.forEach(((t,n)=>{""!==t&&e.push(f[n])})),g.TrackingService.trackEvent({type:"manageConfigPage.errorOnSubmit",data:{errorUseCases:e.join(", ")}});const{records:t}=await M();return P=t,{error:s}}return P=e,{records:P}})(t);(s||o.length)&&(s&&r(s),o.length?a(O(o)):n())},customValidators:A})),!u&&!c&&s().createElement(E.Z,null),c&&s().createElement(V,{"data-test-name":W.WAITSPINNER},s().createElement(_(),{size:"medium"})))}))},72361:(e,t,n)=>{"use strict";n.d(t,{Bv:()=>u,Nj:()=>h,ZL:()=>E,ao:()=>L});var r,a=n(30168),s=n(12650),o=n.n(s),i=n(97026),c=n.n(i),l=n(95931),p=n(89217),d=n(68937),m=n(79674);const _=c().div(r||(r=(0,a.Z)(["\n    margin: 25px;\n"]))),T=e=>{let{msg:t="Error loading page"}=e;return o().createElement("h2",null,t)},u=function(e){return void 0===e&&(e=[]),t=>{const n=p.o.canReadPage(e);return e=>n?o().createElement(t,e):o().createElement(_,null,o().createElement(T,{msg:m.X.FILTER_HOC.ERRORS.RBAC_FILTER}))}},L=function(e){return void 0===e&&(e=[]),t=>{const n=e.includes(l.N.getSplunkInstanceType());return e=>n?o().createElement(t,e):o().createElement(_,null,o().createElement(T,{msg:m.X.FILTER_HOC.ERRORS.SPLUNK_ENV_FILTER}))}},E=function(e){return void 0===e&&(e=[]),t=>{const n=e.includes(l.N.getOS());return e=>n?o().createElement(t,e):o().createElement(_,null,o().createElement(T,{msg:m.X.FILTER_HOC.ERRORS.OS_FILTER}))}},h=function(e){return void 0===e&&(e=[]),t=>{const n=e.includes(d.D.getExperienceType());return e=>n?o().createElement(t,e):o().createElement(_,null,o().createElement(T,{msg:m.X.FILTER_HOC.ERRORS.SPLUNK_EXPERIENCE_FILTER}))}}},84711:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var r=n(30168),a=n(12650),s=n.n(a),o=n(76416),i=n.n(o),c=n(66206),l=n.n(c),p=n(47934),d=n.n(p),m=n(97212),_=n(97026),T=n.n(_),u=n(79674),L=n(2249),E=n(66070);const h={CONTAINER:"Container",LEARN_MORE_LINK:"LearnmoreLink",TOKEN_AUTH_BTN:"TokenAuthBtn"};(0,L.normalizeDataTestIds)({remoteAppName:E.KH,compName:"TokenAuthDisabled",testIds:h});const I=h;var A,O;const N=T().div(A||(A=(0,r.Z)(["\n    padding: 0px 20px 0;\n"]))),y=T()(l())(O||(O=(0,r.Z)(["\n    margin-left: 5px;\n"]))),S=()=>s().createElement(N,{"data-test-name":I.CONTAINER},s().createElement(d(),null,u.X.TOKEN_AUTH_DISABLED.PAGE_CONTENT,s().createElement(y,{to:(0,m.createDocsURL)(u.X.TOKEN_AUTH_DISABLED.TOKEN_AUTH_LEARN_MORE),openInNewContext:!0,"data-test-name":I.LEARN_MORE_LINK},u.X.COMMON.LEARN_MORE)),s().createElement(i(),{label:u.X.TOKEN_AUTH_DISABLED.TOKEN_AUTH_BTN_LABEL,appearance:"primary",to:(0,m.createURL)(u.X.TOKEN_AUTH_DISABLED.TOKEN_AUTH_URL),openInNewContext:!0,"data-test-name":I.TOKEN_AUTH_BTN}))},16573:(e,t,n)=>{"use strict";n.d(t,{K:()=>m});var r=n(4942),a=n(96486),s=n(17673),o=n(956),i=n(97212),c=n(89217),l=n(82269);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const m=new class{constructor(){(0,r.Z)(this,"isInitialized",!1),(0,r.Z)(this,"acsVersion","v1"),(0,r.Z)(this,"isTokenAuthDisabled",!1),(0,r.Z)(this,"jwtToken",""),(0,r.Z)(this,"stackID",""),(0,r.Z)(this,"acsBaseURL",""),(0,r.Z)(this,"checkIfTokenAuthIsEnabledURL",(0,i.createRESTURL)("admin/Token-auth/tokens_auth?output_mode=json")),(0,r.Z)(this,"createJWTTokenURL",(0,i.createRESTURL)("authorization/tokens?output_mode=json")),(0,r.Z)(this,"stackIDUrl",(0,i.createRESTURL)("properties/web/remoteUI?output_mode=json",{app:"100-whisper-searchhead"})),(0,r.Z)(this,"init",(async e=>{this.isInitialized||(this.acsVersion=e,await this.fetchIsTokenAuthDisabled(),await this.fetchStackID(),await this.createJwtToken(),await this.fetchACSEnv(),this.isInitialized=!0)})),(0,r.Z)(this,"getStackID",(()=>this.stackID)),(0,r.Z)(this,"getACSBaseURL",(()=>this.acsBaseURL)),(0,r.Z)(this,"getACSHeaders",(()=>new Headers({Authorization:"Bearer "+this.jwtToken,"Content-Type":"application/json","User-Agent":"Splunk-ACS-UI"}))),(0,r.Z)(this,"createJwtToken",(async()=>{const e={name:c.o.getCurrUsername(),expires_on:"+2m",audience:"IP_ALLOW_LIST_UI",type:"ephemeral"},t=d(d({},o.pX),{},{method:"POST",body:s.encode(e)});try{const e=await fetch(this.createJWTTokenURL,t),n=await(0,o._y)(201)(e);this.jwtToken=(0,a.get)(n,"entry[0].content.token","")}catch(e){throw new Error(l.Z.CANNOT_CREATE_JWT_TOKEN)}})),(0,r.Z)(this,"withJwtTokenRetry",(async e=>{const t=await e();return 401===t.status?(await this.createJwtToken(),e()):t})),(0,r.Z)(this,"fetchIsTokenAuthDisabled",(async()=>{try{const e=await fetch(this.checkIfTokenAuthIsEnabledURL,d({},o.pX)),t=await(0,o._y)(200)(e);if(this.isTokenAuthDisabled=(0,a.get)(t.entry[0],"content.disabled",!0),this.isTokenAuthDisabled)throw new Error(l.Z.TOKEN_AUTH_DISABLED)}catch(e){throw new Error(l.Z.TOKEN_AUTH_DISABLED)}})),(0,r.Z)(this,"fetchStackID",(async()=>{try{const e=await fetch(this.stackIDUrl,d({},o.pX)),t=(await(0,o._y)(200)(e)).entry.find((e=>"stack_id"===e.name));this.stackID=t.content}catch(e){throw new Error(l.Z.STACK_ID_INVALID)}})),(0,r.Z)(this,"fetchACSEnv",(async()=>{try{const e=this.formatACSBaseUrl("production"),t=this.formatACSBaseUrl("staging"),n="/status";if(200===(await fetch(e+n,{headers:this.getACSHeaders()})).status)return void(this.acsBaseURL=e);if(200===(await fetch(t+n,{headers:this.getACSHeaders()})).status)return void(this.acsBaseURL=t);throw new Error(l.Z.ACS_ENVIRONMENT_NOT_FOUND)}catch(e){throw new Error(l.Z.ACS_ENVIRONMENT_NOT_FOUND)}})),(0,r.Z)(this,"formatACSBaseUrl",(e=>"staging"===e?"https://staging.admin.splunk.com/"+this.stackID+"/adminconfig/"+this.acsVersion:"https://admin.splunk.com/"+this.stackID+"/adminconfig/"+this.acsVersion))}}},33187:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(94015),a=n.n(r),s=n(23645),o=n.n(s)()(a());o.push([e.id,".error-message [data-test='content'] {\n    margin-left: 0px;\n}\n","",{version:3,sources:["webpack://./src/config-page/ip-allow-list/IPAllowList.css"],names:[],mappings:"AAAA;IACI,gBAAgB;AACpB",sourcesContent:[".error-message [data-test='content'] {\n    margin-left: 0px;\n}\n"],sourceRoot:""}]);const i=o},46115:()=>{},52361:()=>{},94616:()=>{}}]);
//# sourceMappingURL=635.635.d2ebc34437854b98bed8.js.map