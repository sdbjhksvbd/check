try:
    import cherrypy
except ImportError:
    cherrypy = None
import splunk.entity as entity
import splunk.pdf.pdfgen_utils as pdfgen_utils
from splunk.rest.splunk_web_requests import get_dashboard_studio_settings

WEB_CONF_ENTITY = '/configs/conf-web'

logger = pdfgen_utils.getLogger()


def is_available(session_key=None):
    """
    read the available flag from web.conf
    :param session_key:
    :return:
    """
    if cherrypy is not None and cherrypy.config is not None and 'pdfgen_is_available' in cherrypy.config:
        pdf_available = cherrypy.config.get('pdfgen_is_available')
    else:
        try:
            settings = entity.getEntity(
                WEB_CONF_ENTITY, 'settings', sessionKey=session_key)
            pdf_available = settings.get('pdfgen_is_available', 0)
        except Exception:
            # failed to retrieve web.conf, we assume pdf service is ready.
            pdf_available = 1
    return pdf_available


def is_studio_dashboard_scheduled_export_enabled(session_key=None):
    """
    read the activate_scheduled_export flag from web-features.conf
    :param session_key:
    :return Boolean:
    """
    studio_flags = get_dashboard_studio_settings(session_key)
    return studio_flags.get('activate_scheduled_export')
