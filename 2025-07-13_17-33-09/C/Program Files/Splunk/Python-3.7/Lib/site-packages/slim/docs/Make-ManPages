#!/usr/bin/env bash

declare -r options="--organization='Splunk, Inc.' --manual='Splunk Packaging Toolkit' --date=$(date +'%Y-%m-%d') --warnings"
declare -r script_root=$(dirname "$(readlink -e $0)")
set -o errexit -o nounset

cd "${script_root}" && mkdir -p ../man/man1

for source in slim*.1.md; do

    manpage=../man/man1/${source%.md}
    echo "${source} -> ${manpage}"
    eval "ronn --pipe --roff ${options} '${source}'" > "${manpage}"

    text=${source%.1.md}.text
    echo "${manpage} -> ${text}"
    cat ${manpage} | groff -man -t -Tutf8 | col -bx > "${text}"

done

html="slim-man-pages.html"
echo slim*.1.md "-> ${html}"
eval "ronn --pipe --html ${options} slim*.1.md" > "${html}"
