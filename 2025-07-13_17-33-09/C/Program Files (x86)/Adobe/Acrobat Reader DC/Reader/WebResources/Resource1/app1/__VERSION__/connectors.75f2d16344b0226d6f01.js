"use strict";(self["webpackJsonp-dc-desktop-app"]=self["webpackJsonp-dc-desktop-app"]||[]).push([[617],{zSbg:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s("plsW"),o=s("Lk87");const a=new class BaseURIModel{constructor(){this._baseFilesURIs={api:"https://files.acrobat.com/api/aax/",cloud_do_not_use:"https://cloud.acrobat.com/",commenting_uri:"https://comments.adobe.io/",download:"https://files-download2.acrocomcontent.com/api/ddx/",ims:"https://ims-na1.adobelogin.com/",prefs:"https://cloud.acrobat.com/api/aax/",rendition:"https://files.acrobat.com/api/rrx/",send_api:"https://send.acrobat.com/a/api/",ui_helpers:"https://cloud.acrobat.com/api/aax/",upload:"https://upload2.files.acrobat.com/api/uux/",users:"https://cloud.acrobat.com/api/aax/"},this._isBaseFilesURISet=!1,this._baseCreatePdfURIs={api:"https://createpdf.acrobat.com/createpdf/api/",users:"https://createpdf.acrobat.com/createpdf/api/",prefs:"https://createpdf.acrobat.com/createpdf/api/",ims:"https://ims-na1.adobelogin.com/",blueheron:"https://files.acrobat.com/",ipmcontext:"https://createpdf.acrobat.com/createpdf/api/users/me/ipm_context"},this._isBaseCreatePdfURISet=!1,this._durableLinkBaseURI="https://acrobat.adobe.com/id/",this._isDurableLinkBaseURISet=!1,this._invitationBaseURI="https://invitations.adobe.io/api/v4"}get isBaseFilesURISet(){return this._isBaseFilesURISet}get isBaseCreatePdfURISet(){return this._isBaseCreatePdfURISet}get isDurableLinkBaseURISet(){return this._isDurableLinkBaseURISet}async getBaseFilesURIs(){const e=new o.Z;try{if(!this.isBaseFilesURISet){const e=await i.providers["native-api"](),t=await e.ResponseCacheAPI(),s=await t.GetBaseURIs("Files");null!=s&&(this._baseFilesURIs.api=null!=s.api&&""!=s.api?s.api:this._baseFilesURIs.api,this._baseFilesURIs.cloud_do_not_use=null!=s.cloud_do_not_use&&""!=s.cloud_do_not_use?s.cloud_do_not_use:this._baseFilesURIs.cloud_do_not_use,this._baseFilesURIs.commenting_uri=null!=s.commenting_uri&&""!=s.commenting_uri?s.commenting_uri:this._baseFilesURIs.commenting_uri,this._baseFilesURIs.download=null!=s.download&&""!=s.download?s.download:this._baseFilesURIs.download,this._baseFilesURIs.ims=null!=s.ims&&""!=s.ims?s.ims:this._baseFilesURIs.ims,this._baseFilesURIs.prefs=null!=s.prefs&&""!=s.prefs?s.prefs:this._baseFilesURIs.prefs,this._baseFilesURIs.rendition=null!=s.rendition&&""!=s.rendition?s.rendition:this._baseFilesURIs.rendition,this._baseFilesURIs.send_api=null!=s.send_api&&""!=s.send_api?s.send_api:this._baseFilesURIs.send_api,this._baseFilesURIs.ui_helpers=null!=s.ui_helpers&&""!=s.ui_helpers?s.ui_helpers:this._baseFilesURIs.ui_helpers,this._baseFilesURIs.upload=null!=s.upload&&""!=s.upload?s.upload:this._baseFilesURIs.upload,this._baseFilesURIs.users=null!=s.users&&""!=s.users?s.users:this._baseFilesURIs.users),this._isBaseFilesURISet=!0}e.resolve(this._baseFilesURIs)}catch(t){e.resolve(this._baseFilesURIs)}return e.promise}async getBaseCreatePdfURIs(){const e=new o.Z;try{if(!this.isBaseCreatePdfURISet){const e=await i.providers["native-api"](),t=await e.ResponseCacheAPI(),s=await t.GetBaseURIs("CreatePDF");null!=s&&(this._baseCreatePdfURIs.api=null!=s.api&&""!=s.api?s.api:this._baseCreatePdfURIs.api,this._baseCreatePdfURIs.users=null!=s.users&&""!=s.users?s.users:this._baseCreatePdfURIs.users,this._baseCreatePdfURIs.ims=null!=s.ims&&""!=s.ims?s.ims:this._baseCreatePdfURIs.ims,this._baseCreatePdfURIs.prefs=null!=s.prefs&&""!=s.prefs?s.prefs:this._baseCreatePdfURIs.prefs,this._baseCreatePdfURIs.blueheron=null!=s.blueheron&&""!=s.blueheron?s.blueheron:this._baseCreatePdfURIs.blueheron,this._baseCreatePdfURIs.ipmcontext=null!=s.ipmcontext&&""!=s.ipmcontext?s.ipmcontext:this._baseCreatePdfURIs.ipmcontext),this._isBaseCreatePdfURISet=!0}e.resolve(this._baseCreatePdfURIs)}catch(t){e.resolve(this._baseCreatePdfURIs)}return e.promise}async getDurableLinkBaseURI(){const e=new o.Z;try{if(!this.isDurableLinkBaseURISet){const e=await i.providers["native-api"](),t=await e.UnifiedSharePopupAPI(),s=await t.GetDurableLinkBaseURIFromDiscoveryResponse();this._durableLinkBaseURI=null!=s&&""!=s?s:this._durableLinkBaseURI}}catch(e){}return e.resolve(this._durableLinkBaseURI),e.promise}async getInvitationBaseURI(){const e=new o.Z;try{const e=await i.providers["native-api"](),t=await e.UnifiedSharePopupAPI(),s=await t.GetInvitationBaseURIFromDiscoveryResponse();this._invitationBaseURI=null!=s&&""!=s?s:this._invitationBaseURI}catch(e){}return e.resolve(this._invitationBaseURI),e.promise}}},TQoS:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ConnectorsProvider});var i=s("plsW"),o=s("/fmr"),a=s("A34E"),n=s("DeC6"),r=s("siW8");class BootstrapRequestCommand extends r.V{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(r.v.BOOTSTRAP),this.mAssetId=e,this.mShareInfo=t}get assetId(){return this.mAssetId}set assetId(e){this.mAssetId=e}get shareInfo(){return this.mShareInfo}set shareInfo(e){this.mShareInfo=e}}var c=s("Lk87"),l=s("DJg0"),d=s("jifT");class CachedFileInfo{constructor(e){this.name=e.name,this.size=e.size,e.date&&(this.date=Math.round(e.date.getTime()/1e3).toString()),this.id=e.id.toString(),this.type=e.type}}class CachedFolderInfo{constructor(e){this.name=e.name,this.id=e.id.toString(),this.type=e.type}}class FileListCacheKey{constructor(e,t,s){this.connector=e,this.accountId=t,this.folderId=s}}class FileListCacheValue{constructor(e){this.sortBy="name",this.sortDirection="ascending",this.savedAt="",this.ttl=3600,this.assetList=e}isStale(){return Date.now()/1e3>parseInt(this.savedAt,10)+this.ttl}}class PersistentFileListCache{constructor(){this.mCache=new Map}static GetInstance(){return PersistentFileListCache.instance||(PersistentFileListCache.instance=new PersistentFileListCache),PersistentFileListCache.instance}static async Add(e,t){const s=await d.default.getInstance(),i=await s.connectorsAPI();t.savedAt=Math.round(Date.now()/1e3).toString(),i.addToFileListCache(e,t)}static async Get(e){const t=await d.default.getInstance(),s=await t.connectorsAPI(),i=await s.getFileListFromCache(e);if(i&&i.assetList){const e=new FileListCacheValue(i.assetList);if(e.sortBy=null==i?void 0:i.sortBy,e.sortDirection=null==i?void 0:i.sortDirection,e.savedAt=null==i?void 0:i.savedAt,e.ttl=null==i?void 0:i.ttl,e.isStale())return;return e}}}var h=s("zSbg");class DCFolderInfo{constructor(e,t){this.type=o.h3.FOLDER,this.name="",this.id="",this.name=e,this.id=t}}class DCFileInfo{constructor(e){this.type=a.Z.getAssetTypeFromMimeType(e.type),this.name=e.name,this.size=e.size,this.date=new Date(e.created),this.id=e.asset_id,this.isShared=e.is_shared,!0===this.isShared&&(this.associatedIcons=o.R5.kShared)}}class DCFileListPage{constructor(e,t){this.members=[],this.pageNum=e,this.pageUri=t}}class DCFileListProvider{constructor(){this.mFileListCache={},this.CacheFileListForFolder=this.CacheFileListForFolder.bind(this),this.CacheRootFolder=this.CacheRootFolder.bind(this)}async GetRootFolder(){if(this.mRootFolder)return this.mRootFolder;const e=await i.providers["dc-discovery"](),t=(await e.GetDCDiscoveryReponse()).resources.folders.get_root,s=await e.GetHTTPHeaders(t.accept["root_v1.json"]),o=(await i.providers["network-api"]()).GetNetworkQuery(t.uri,{},{method:t.http_method,headers:s},{staleTime:36e5}),a=new c.Z,n={onResponse:e=>{this.mRootFolder=new DCFolderInfo("/",e.folder_id),a.resolve(this.mRootFolder),setTimeout((()=>{this.CacheRootFolder(this.mRootFolder)}),0)},onStatusChange:e=>{},onError:e=>{a.reject(e)}};return o.Subscribe(n),o.Refresh(),a.promise}CacheRootFolder(e){const t=new FileListCacheKey("dc","dc","root"),s=new FileListCacheValue([new CachedFolderInfo(e)]);PersistentFileListCache.Add(t,s)}CreateFileListUriParams(e){const t={page_size:20};if(e){let s="";switch(e.column){case o.hg.name:s="name";break;case o.hg.type:s="extension";break;case o.hg.size:s="size";break;case o.hg.date:s="created"}""!==s&&(t.order_by=s,t.sort_order=e.direction?e.direction:"ascending")}return t}async GetFileList(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!(e instanceof DCFolderInfo))return[];const o=e.id;this.mActiveSortDescriptor=s;let a="";do{if(!(o in this.mFileListCache))break;const e=this.mFileListCache[o].get(s);if(!e)break;if(t>=e.length)break;if(e[t].members.length>0)return e;if(""!==e[t].pageUri){a=e[t].pageUri;break}}while(0);if(0!==t&&0===a.length)return[];if(!this.mAllowedFileExtns){const e=await d.default.getInstance(),t=await e.fileAPI();this.mAllowedFileExtns=t.getAllowedFileExtensions()}const n=await i.providers["dc-discovery"](),r=(await n.GetDCDiscoveryReponse()).resources.folders.list,l=await n.GetHTTPHeaders(r.accept["folder_listing_v1.json"]);0===a.length&&(a=n.ParseDiscoveryUriToFullUri(r.uri,{folder_id:o},this.CreateFileListUriParams(s)),o in this.mFileListCache||(this.mFileListCache[o]=new Map),this.mFileListCache[o].set(s,[new DCFileListPage(t,a)]));const h=(await i.providers["network-api"]()).GetNetworkQuery(a,{},{method:r.http_method,headers:l}),u=new c.Z,m={onResponse:async i=>{h.Unsubscribe(m);try{const o=await this.HandleFileListResponse(i,e,t,s);u.resolve(o)}catch(e){u.reject(e)}},onStatusChange:e=>{},onError:e=>{h.Unsubscribe(m),u.reject(e)}};return h.Subscribe(m),h.Refresh(),u.promise}ProcessFileList(e){return e.map((e=>"folder"===e.object_type?new DCFolderInfo(e.name,e.folder_id):new DCFileInfo(e)))}async HandleFileListResponse(e,t,s,i){var o,a;const n=null===(o=this.mFileListCache[t.id])||void 0===o?void 0:o.get(i);if(!n)throw"File list cache does not exist";const r=this.ProcessFileList(e.members);return n[s].members=await this.FetchSharedFilesInfo(r),"next_page_uri"in e._pages&&(n[s+1]=new DCFileListPage(s+1,e._pages.next_page_uri)),(null===(a=this.mRootFolder)||void 0===a?void 0:a.id)===t.id&&setTimeout((()=>{this.CacheFileListForFolder(t)}),0),n}async FetchSharedFilesInfo(e){const t=await i.providers["dc-discovery"](),s=await t.GetDCDiscoveryReponse();if(!this.IsACPUser(s))return e;const a=this.GetSearchRequestURI(s),n=await t.GetUSSHTTPHeaders(),r={scope:["creative_cloud"],asset_id:e.filter((e=>e.type!==o.h3.FOLDER)).map((e=>e.id)),creative_cloud_asset_type:["asset"],op_field_exists:["collab_metadata$$shared_by"],fetch_fields:{includes:["collab_metadata.shared_by"]},op_none_of:[{"api:metadata/application$$shell:visibility":["hiddenSelf","hiddenRecursive"]},{"app_metadata$$project:directoryType":"team"},{op_field_exists:["app_metadata$$cc:inherited$$cc:team"]}],creative_cloud_toplevel_collection_name:"cloud-content",asset_id_opacity:!0},l=(await i.providers["network-api"]()).GetNetworkMutation(a,{},{method:"POST",headers:n}),d=new c.Z,h={onResponse:t=>{l.Unsubscribe(h);const s=t;void 0===s.metrics||void 0===s.result_sets||s.metrics.total_hits<=0||s.result_sets.length<=0||void 0===s.result_sets[0].items||s.result_sets[0].items.length<=0||s.result_sets[0].items.forEach((t=>{if(void 0===t.collab_metadata||void 0===t.collab_metadata.shared_by||t.collab_metadata.shared_by.length<=0)return;const s=e.find((e=>e.id===t.asset_id));if(void 0===s)return;const i=s;i.isShared=!0,i.associatedIcons=o.R5.kShared})),d.resolve(e)},onStatusChange:e=>{},onError:t=>{console.error(t),l.Unsubscribe(h),d.resolve(e)}};return l.Subscribe(h),l.Mutate(r),d.promise}async SaveFile(e,t,s,o,a,n,r){if(!(e instanceof DCFolderInfo))return;if("string"==typeof t){if(0===t.length)return}else if(!(t instanceof DCFileInfo))return;const c={saveAsParentFolderid:e.id,closeWindow:!0};"string"==typeof t?c.saveAsFilename=this.SanitizeFileName(t):(c.saveAsFilename=t.name,c.selectedBHFiles=[{id:t.id,name:t.name}]),"boolean"==typeof s&&(c.reduceFileSize=s),"boolean"==typeof o&&(c.isExportButtonSelected=o),"string"==typeof a&&(c.outputFormatFromSaveAs=a),"string"==typeof n&&(c.fileSaveAsSelectedPluginId=n);const l=await i.providers["native-api"](),d=await l.fileAPI();d.setFileAncestor([e.id],1),d.setSelectedFilesData(c),setTimeout((()=>{this.CacheFileListForFolder(e)}),1)}async OpenFiles(e){if(e.some((e=>!(e instanceof DCFileInfo)||e.isShared&&!e.bootstrap)))return;const t={selectedBHFiles:e.map((e=>{const t=e.bootstrap;return{id:e.id.toString(),name:e.name,bootstrap:t,bootstrapStr:JSON.stringify(t||{}),is_shared:e.isShared||!1}}))};(0,l.bL)(t)}async FetchBootstrapData(e){var t;const s=await i.providers["collaboration-api"](),o=new BootstrapRequestCommand(e.id,!0),a=await s.ExecuteCollabCommand(o);if(a&&a.ERR_CODE===n.q.NO_ERROR)return null===(t=null==a?void 0:a.data)||void 0===t?void 0:t.full_bootstrap_response;throw new Error("Failed to fetch bootstrap data")}async OnFilesSelected(e){const t=[];e.forEach((e=>{let s;if(!(e instanceof DCFileInfo))return;const i=e;s=void 0===i.isShared||i.isShared?void 0===i.bootstrap?this.FetchBootstrapData(i):Promise.resolve(!0):Promise.resolve(!1),t.push(s)}));(await Promise.allSettled(t)).forEach(((t,s)=>{const i=e[s];"rejected"===t.status||!1===t.value?(i.isShared=!1,i.bootstrap={}):"fulfilled"===t.status&&!0===t.value?i.isShared=!0:(i.isShared=!0,i.bootstrap=t.value)}))}async GetFileListFromCache(e,t){if(!(e instanceof DCFolderInfo))return;const s=new FileListCacheKey("dc","dc",e.id),i=await PersistentFileListCache.Get(s);if(i&&i.assetList.length>0){const e=new DCFileListPage(0,""),s=i.assetList.map((e=>{var t;if(e.type===o.h3.FOLDER){const t=e;return new DCFolderInfo(t.name,t.id.toString())}const s=e,i=new DCFileInfo({name:s.name,size:s.size,asset_id:null===(t=s.id)||void 0===t?void 0:t.toString()});return i.type=s.type,s.date&&(i.date=new Date(1e3*parseInt(s.date,10))),i})),a=t.column?t.column:o.hg.name,n="descending"===(t.direction?t.direction:"ascending")?-1:1;return s.sort(((e,t)=>{const s=e.type===o.h3.FOLDER,i=t.type===o.h3.FOLDER;if(s!==i)return s?-1:1;if(s&&i){return e.name.toLocaleLowerCase()<t.name.toLocaleLowerCase()?-1:1}if(a===o.hg.name){const s=e.name.toLocaleLowerCase(),i=t.name.toLocaleLowerCase();return n*(s<i?-1:1)}return 0})),e.members=s,[e]}}async GetRootFolderFromCache(){const e=new FileListCacheKey("dc","dc","root"),t=await PersistentFileListCache.Get(e);if(t&&1===t.assetList.length){const e=t.assetList[0];return new DCFolderInfo(e.name,e.id.toString())}}async CacheFileListForFolder(e){if(!(e instanceof DCFolderInfo))return;if(!this.mActiveSortDescriptor)return;const t=e.id;let s=[];const i=this.mFileListCache[t].get(this.mActiveSortDescriptor);if(!i)return;i.forEach((e=>{s=s.concat(e.members)}));const a=s.map((e=>e.type===o.h3.FOLDER?new CachedFolderInfo(e):new CachedFileInfo(e))),n=new FileListCacheKey("dc","dc",t),r=new FileListCacheValue(a);r.sortBy=this.mActiveSortDescriptor.column?this.mActiveSortDescriptor.column.toString():o.hg.name,r.sortDirection=this.mActiveSortDescriptor.direction?this.mActiveSortDescriptor.direction:"ascending",PersistentFileListCache.Add(n,r)}async FindFileWithName(e,t){if(e&&t&&t instanceof DCFolderInfo)return e=this.SanitizeFileName(e),this.GetExistingFileInFolder(e,t)}SanitizeFileName(e){if(""===e)return e;let t=e.normalize("NFC");const s=a.Z.getExtension(t),i=this.mAllowedFileExtns;return i&&i.size>0&&(s&&i.has(s.toLowerCase())||(t+=[...i][0])),t}IsACPUser(e){return e.templates.search_uri_primary&&"{+search_uri_v2}"===e.templates.search_uri_primary}GetSearchRequestURI(e){return this.IsACPUser(e)?e.templates.search_uri_v2:e.templates.search_uri}async GetSearchRequestBody(e,t,s){const i=s,o=this.IsACPUser(e);let a={q:t,container:{asset_id:[i.id]},parent_id:[i.id],limit:1,sort_orderby:"asset_name",sort_order:"asc"};return a=o?Object.assign(a,{scope:["creative_cloud"],op_none_of:[{"api:metadata/application$$shell:visibility":["hiddenSelf","hiddenRecursive"]},{"app_metadata$$project:directoryType":"team"},{op_field_exists:["app_metadata$$cc:inherited$$cc:team"]}],creative_cloud_asset_type:["asset","collection"],creative_cloud_toplevel_collection_name:"cloud-content",start_index:0,asset_id_opacity:!0,fetch_fields:{includes:["collab_metadata.collaborators","collab_metadata.shared_by"]}}):Object.assign(a,{scope:["document_cloud"],subScope:"document_cloud"}),a}async GetExistingFileInFolder(e,t){if(!(t.id in this.mFileListCache))return;const s=e.toLocaleLowerCase(),o=await i.providers["dc-discovery"](),a=await o.GetDCDiscoveryReponse(),n=this.GetSearchRequestURI(a),r=await o.GetUSSHTTPHeaders(),l=await this.GetSearchRequestBody(a,s,t),d=(await i.providers["network-api"]()).GetNetworkMutation(n,{},{method:"POST",headers:r}),h=new c.Z,u={onResponse:e=>{d.Unsubscribe(u),console.log({responseData:e});const t=e;if(t.metrics&&t.result_sets&&t.metrics.total_hits>0&&t.result_sets.length>0&&t.result_sets[0].items&&t.result_sets[0].items.length>0){const e=t.result_sets[0].items[0];if(e.asset_name&&e.asset_name.toLocaleLowerCase()===s){let t=!1;return e.custom_document_cloud_metadata&&e.custom_document_cloud_metadata.is_shared&&(t=e.custom_document_cloud_metadata.is_shared),e.collab_metadata&&e.collab_metadata.shared_by&&e.collab_metadata.shared_by.length>0&&(t=!0),void h.resolve(new DCFileInfo({name:e.asset_name,asset_id:e.asset_id,type:e.type,size:e.size,created:e.create_date,is_shared:t}))}}h.resolve(void 0)},onStatusChange:e=>{},onError:e=>{console.error({errorData:e}),d.Unsubscribe(u),h.reject(e)}};return d.Subscribe(u),d.Mutate(l),h.promise}async CreateFolder(e,t){if(!(e instanceof DCFolderInfo))return[];const s=e.id,o=await i.providers["dc-discovery"](),a=await o.GetDCDiscoveryReponse(),n=a.resources.folders.create,r=await o.GetHTTPHeaders(n.accept["folder_v1.json"],n.content_type["folder_creation_v1.json"]),l={name:t,parent_uri:o.ParseDiscoveryUriToFullUri(a.templates.folder_uri,{folder_id:s},{}),on_dup_name:"error"},d=(await i.providers["network-api"]()).GetNetworkMutation(n.uri,{},{method:n.http_method,headers:r},{retries:0}),h=new c.Z,u={onResponse:e=>{void 0!==e.uri&&this.mFileListCache[s].clear(),h.resolve(e),d.Unsubscribe(u)},onStatusChange:e=>{},onError:e=>{h.reject(e),d.Unsubscribe(u)}};return d.Subscribe(u),d.Mutate(l),h.promise}async getBreadcrumbs(e){const t=await i.providers["dc-discovery"](),s=(await t.GetDCDiscoveryReponse()).resources.folders.breadcrumbs,o=await t.GetHTTPHeaders(s.accept["folder_breadcrumbs_v1.json"]),a=t.ParseDiscoveryUriToFullUri(s.uri,{folder_id:e},{}),n=(await i.providers["network-api"]()).GetNetworkQuery(a,{},{method:s.http_method,headers:o}),r=new c.Z,l={onResponse:e=>{if(n.Unsubscribe(l),!e)return void r.reject("Response data is empty");const t=null==e?void 0:e.breadcrumbs,s=[];null==t||t.forEach((e=>{let t=e.uri.split("/");t=t[t.length-1],s.push(new DCFolderInfo(e.name,t))})),r.resolve(s)},onStatusChange:e=>{},onError:e=>{n.Unsubscribe(l),r.reject(e)}};return n.Subscribe(l),n.Refresh(),r.promise}async GetBreadcrumbsForCurrentFSD(){const e=await d.default.getInstance(),t=await e.fileAPI(),s=await t.getFileAncestors();return void 0!==s&&s.length>0?await this.getBreadcrumbs(s):[]}async ValidateAssetName(e){const t=await i.providers["dc-discovery"](),s=await i.providers["native-api"](),o=await s.SessionAPI(),a=(await h.Z.getBaseFilesURIs()).api+"name_validator?x-api-client-id="+o.xApiClientId,n=await t.GetNameValidatorHTTPHeaders(),r={name:e},l=(await i.providers["network-api"]()).GetNetworkMutation(a,{},{method:"POST",headers:n},{retries:0}),d=new c.Z,u={onResponse:e=>{e&&(e.status>=300||e.status<=200)?d.resolve(!1):d.resolve(!0),l.Unsubscribe(u)},onStatusChange:e=>{},onError:e=>{d.resolve(!1),l.Unsubscribe(u)}};return l.Subscribe(u),l.Mutate(r),d.promise}}var u=s("pU5Y");class ConnectorFolderInfo extends u.Z{constructor(){super(...arguments),this.id="",this.name="",this.type=o.h3.FOLDER}setName(e){this.name=e}setId(e){this.id=e}}class ConnectorFileInfo extends u.Z{constructor(){super(...arguments),this.storagekey="",this.id="",this.type=o.h3.OTHER,this.name="",this.size=0}setName(e){this.name=e}setId(e){this.id=e}setModifiedDate(e){this.date=e}setType(e){this.type=e}setSize(e){this.size=e}}class ConnectorFileListPage{constructor(){this.pageNum=0,this.members=[]}}class ConnectorFileListAttributes{constructor(){this.sortBy="none",this.sortDirection="assending",this.supportedExtns=["pdf"],this.pageSize=1e3}}class ConnectorFilesProvider{constructor(e,t){this.viewMode="saveAs",this.mFileListCache=new Map,this.connectorName=e,this.accountId=t}ClearCache(){this.mFileListCache.size&&this.mFileListCache.clear()}async GetRootFolder(){if(this.mRootFolder)return this.mRootFolder;const e=await d.default.getInstance(),t=await e.connectorsAPI(),s=(await t.getRootFolder(this.connectorName,this.accountId)).data,i=new ConnectorFolderInfo({proxy:s});return i.createContext(),this.mRootFolder=i,this.mRootFolder.setName("/"),this.mRootFolder}async SortConnectorFileList(e,t){const s=t.column?t.column:o.hg.name,i="descending"===(t.direction?t.direction:"ascending")?-1:1;null==e||e.members.sort(((e,t)=>{const n=e.type===o.h3.FOLDER,r=t.type===o.h3.FOLDER;if(n!==r)return n?-1:1;if(n&&r){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase();return i*(s<o?-1:1)}if(s===o.hg.name){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase();return i*(s<o?-1:1)}if(s===o.hg.type){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase(),n=a.Z.getExtension(s)||"",r=a.Z.getExtension(o)||"";return i*(n<r?-1:1)}const c=e,l=t;if(c&&l){if(s===o.hg.size){const e=c.size<l.size?-1:1;return i*e}if(c.date&&l.date&&s===o.hg.date){const e=c.date.getTime()<l.date.getTime()?-1:1;return i*e}}return 0}))}async GetFileList(e,t,s,i){var o;if(!(e instanceof ConnectorFolderInfo))return[];const a=[];if(this.mFileListCache.has(e)){const t=null===(o=this.mFileListCache.get(e))||void 0===o?void 0:o.pop();t&&(this.SortConnectorFileList(t,s),a.push(t)),this.mFileListCache.set(e,a)}else{const t=new ConnectorFileListAttributes,i=await this.FetchFileListDataForFolder(e,t),o=new ConnectorFileListPage;if(!this.mAllowedFileExtns){const e=await d.default.getInstance(),t=await e.fileAPI();this.mAllowedFileExtns=t.getAllowedFileExtensions()}const n=await this.ParseFilesData(i);o.members=o.members.concat(n),this.SortConnectorFileList(o,s),a.push(o),this.mFileListCache.set(e,a)}return this.mFileListCache.get(e)}async SaveFile(e,t,s,o,a,n,r){if(!(e instanceof ConnectorFolderInfo))return;if("string"==typeof t){if(0===t.length)return}else if(!(t instanceof ConnectorFileInfo))return;const c={saveAsParentFolderObject:e.getProxy(),closeWindow:!0};if("string"==typeof t){c.saveAsFilename=this.SanitizeFileName(t);const s=this.GetExistingFileInFolder(c.saveAsFilename,e);s&&(c.selectedFileObjects=[s.getProxy()],c.saveAsFilename=s.name)}else{({selectedFileObjects:[t.getProxy()]}).saveAsFilename=t.name}"boolean"==typeof s&&(c.reduceFileSize=s),"boolean"==typeof o&&(c.isExportButtonSelected=o),"string"==typeof a&&(c.outputFormatFromSaveAs=a),"string"==typeof n&&(c.fileSaveAsSelectedPluginId=n);const l=await i.providers["native-api"](),d=await l.fileAPI();if(r&&r.length>0){let e=[];r.forEach((t=>{e.push(t.getProxyId())})),d.setFileAncestor(e,0)}d.setSelectedFilesData(c)}async OpenFiles(e){const t={selectedFileObjects:e.map((e=>e.getProxy()))};(0,l.bL)(t)}async OnFilesSelected(e){console.warn("OnFilesSelected nothing to do for ConnectorFileListProvider")}async FindFileWithName(e,t){if(e&&t&&t instanceof ConnectorFolderInfo)return e=this.SanitizeFileName(e),this.GetExistingFileInFolder(e,t)}SanitizeFileName(e){if(""===e)return e;let t=e.normalize("NFC");const s=a.Z.getExtension(t),i=this.mAllowedFileExtns;return i&&i.size>0&&(s&&i.has(s.toLowerCase())||(t+=[...i][0])),t}GetExistingFileInFolder(e,t){const s=t;if(!this.mFileListCache.has(s))return;const i=e.toLowerCase(),a=this.mFileListCache.get(s);let n;return a&&a.some((e=>{const t=e.members.find((e=>e.type!==o.h3.FOLDER&&e.name.toLowerCase()===i));return!!t&&(n=t,!0)})),n||void 0}async CreateFolder(e,t){return console.error("Operation not supported."),{}}async FetchFileListDataForFolder(e,t){const s=await d.default.getInstance(),i=await s.connectorsAPI(),o=e;return(await i.getFilesForFolder(this.accountId,o.getProxy(),t,this.connectorName,!0)).data.folderItems}async GetRootFolderFromCache(){}async GetFileListFromCache(e,t){}async ParseFilesData(e){const t=[];for(const s of e){let e=!0;let i;if("folder"===s.object_type._value)i=new ConnectorFolderInfo({proxy:s}),i.createContext(),i.setName(i.get("name"));else{i=new ConnectorFileInfo({proxy:s}),i.createContext();const t=i.get("name");e=this.ShouldShowFile(t),e&&(i.setName(t),this.SetFileProperties(i))}e&&(i.setId(i.getProxy()._id.toString()),t.push(i))}return t}ShouldShowFile(e){const t=a.Z.getExtension(e);return!!t&&!(this.mAllowedFileExtns&&!this.mAllowedFileExtns.has(t))}SetFileProperties(e){e.setModifiedDate(new Date(e.get("modified")));let t=o.h3.OTHER;const s=e.get("content_type");if(s)t=a.Z.getAssetTypeFromMimeType(s);else{let s=e.get("ext");s||(s=a.Z.getExtension(e.get("name"))),s&&(t=a.Z.getAssetTypeForFileExt(s))}e.setType(t),e.setSize(e.get("size"))}async GetBreadcrumbsForCurrentFSD(){const e=await d.default.getInstance(),t=await e.fileAPI(),s=await t.getFileAncestors(),i=[];return void 0!==s&&s.length>0&&s.forEach(((e,t)=>{const s=new ConnectorFolderInfo({proxy:e});s.createContext(),0===t?s.setName("/"):s.setName(s.get("name")),i.push(s)})),i}async ValidateAssetName(e){const t=await d.default.getInstance(),s=await t.connectorsAPI();try{const t=await s.isFileNameValid(this.connectorName,e);return!(!t.data||!0!==t.data)}catch(e){return!1}}}class ConnectorPaginatedFileListProvider_ConnectorFolderInfo extends u.Z{constructor(){super(...arguments),this.id="",this.name="",this.type=o.h3.FOLDER}setName(e){this.name=e}setId(e){this.id=e}}class ConnectorPaginatedFileListProvider_ConnectorFileInfo extends u.Z{constructor(){super(...arguments),this.id="",this.type=o.h3.OTHER,this.name="",this.size=0}setName(e){this.name=e}setId(e){this.id=e}setModifiedDate(e){this.date=e}setType(e){this.type=e}setSize(e){this.size=e}}class ConnectorPaginatedFileListProvider_ConnectorFileListPage{constructor(e,t){this.members=[],this.pageNum=e,this.nextPage=t}}class ConnectorPaginatedFileListProvider_ConnectorFileListAttributes{constructor(){this.sortBy="none",this.sortDirection="assending",this.supportedExtns=["pdf"],this.pageSize=1e3}}class ConnectorPaginatedFilesProvider{constructor(e,t){this.viewMode="saveAs",this.mFileListCache={},this.connectorName=e,this.accountId=t}async GetRootFolder(){if(this.mRootFolder)return this.mRootFolder;const e=await d.default.getInstance(),t=await e.connectorsAPI(),s=(await t.getRootFolder(this.connectorName,this.accountId)).data,i=new ConnectorPaginatedFileListProvider_ConnectorFolderInfo({proxy:s});return i.createContext(),this.mRootFolder=i,this.mRootFolder.setName("/"),this.mRootFolder}async SortConnectorFileList(e,t){const s=t.column?t.column:o.hg.name,i="descending"===(t.direction?t.direction:"ascending")?-1:1;null==e||e.members.sort(((e,t)=>{const n=e.type===o.h3.FOLDER,r=t.type===o.h3.FOLDER;if(n!==r)return n?-1:1;if(n&&r){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase();return i*(s<o?-1:1)}if(s===o.hg.name){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase();return i*(s<o?-1:1)}if(s===o.hg.type){const s=e.name.toLocaleLowerCase(),o=t.name.toLocaleLowerCase(),n=a.Z.getExtension(s)||"",r=a.Z.getExtension(o)||"";return i*(n<r?-1:1)}const c=e,l=t;if(c&&l){if(s===o.hg.size){const e=c.size<l.size?-1:1;return i*e}if(c.date&&l.date&&s===o.hg.date){const e=c.date.getTime()<l.date.getTime()?-1:1;return i*e}}return 0}))}async GetFileList(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!(e instanceof ConnectorPaginatedFileListProvider_ConnectorFolderInfo))return[];const o=e.name+e.id;do{if(!(o in this.mFileListCache))break;const e=this.mFileListCache[o].get(s);if(!e)break;if(t>=e.length)break;if(e[t].members.length>0)return e;if(e[t].nextPage)break}while(0);let a=[];o in this.mFileListCache&&this.mFileListCache[o].has(s)&&(a=this.mFileListCache[o].get(s));const n=new ConnectorPaginatedFileListProvider_ConnectorFileListAttributes;"onedrive"!==this.connectorName&&"onedrivebusiness"!==this.connectorName||i?"type"===s.column?n.sortBy="none":"onedrivebusiness"!==this.connectorName||"size"!==s.column&&"date"!==s.column?(n.sortBy=s.column?s.column.toString():n.sortBy,n.sortDirection=s.direction?s.direction:n.sortDirection):n.sortBy="none":n.sortBy="none";let r=!0;0!=t&&(r=!1);const c=await this.FetchFileListDataForFolder(e,n,r),l=new ConnectorPaginatedFileListProvider_ConnectorFileListPage(t,!1);if(!this.mAllowedFileExtns){const e=await d.default.getInstance(),t=await e.fileAPI();this.mAllowedFileExtns=t.getAllowedFileExtensions()}const h=await this.ParseFilesData(c.fileListPage);l.members=h;const u=c.hasNextPage;return"none"==n.sortBy&&this.SortConnectorFileList(l,s),a[t]?a[t].members=l.members:a.push(l),u&&(a[t+1]=new ConnectorPaginatedFileListProvider_ConnectorFileListPage(t+1,u),a[t+1].members=[]),o in this.mFileListCache||(this.mFileListCache[o]=new Map),this.mFileListCache[o].set(s,a),this.mFileListCache[o].get(s)}async SaveFile(e,t,s,o,a,n,r){if(!(e instanceof ConnectorPaginatedFileListProvider_ConnectorFolderInfo))return;if("string"==typeof t){if(0===t.length)return}else if(!(t instanceof ConnectorPaginatedFileListProvider_ConnectorFileInfo))return;const c={saveAsParentFolderObject:e.getProxy(),closeWindow:!0};if("string"==typeof t){c.saveAsFilename=this.SanitizeFileName(t);const s=this.GetExistingFileInFolder(c.saveAsFilename,e);s&&(c.selectedFileObjects=[s.getProxy()],c.saveAsFilename=s.name)}else c.selectedFileObjects=[t.getProxy()],c.saveAsFilename=t.name;"boolean"==typeof s&&(c.reduceFileSize=s),"boolean"==typeof o&&(c.isExportButtonSelected=o),"string"==typeof a&&(c.outputFormatFromSaveAs=a),"string"==typeof n&&(c.fileSaveAsSelectedPluginId=n);const l=await i.providers["native-api"](),d=await l.fileAPI();if(r&&r.length>0){const e=[];r.forEach((t=>{e.push(t.getProxyId())})),d.setFileAncestor(e,0)}d.setSelectedFilesData(c)}async OpenFiles(e){const t={selectedFileObjects:e.map((e=>e.getProxy()))};(0,l.bL)(t)}async OnFilesSelected(e){console.warn("OnFilesSelected nothing to do for ConnectorPaginatedFileListProvider")}async FindFileWithName(e,t){if(e&&t&&t instanceof ConnectorPaginatedFileListProvider_ConnectorFolderInfo)return e=this.SanitizeFileName(e),this.GetExistingFileInFolder(e,t)}SanitizeFileName(e){if(""===e)return e;let t=e.normalize("NFC");const s=a.Z.getExtension(t),i=this.mAllowedFileExtns;return i&&i.size>0&&(s&&i.has(s.toLowerCase())||(t+=[...i][0])),t}GetExistingFileInFolder(e,t){const s=t.name+t.id;if(!(s in this.mFileListCache))return;const i=e.toLowerCase(),a=this.mFileListCache[s];let n,r;if(a)for(const[e,t]of a.entries())"name"===e.column&&(n=t,0!==n.length&&n.some((e=>{const t=e.members.find((e=>e.type!==o.h3.FOLDER&&e.name.toLowerCase()===i));if(t)return r=t,!0})));return r||void 0}async CreateFolder(e,t){return console.error("Operation not supported."),{}}async FetchFileListDataForFolder(e,t,s){const i=await d.default.getInstance(),o=await i.connectorsAPI(),a=e,n=await o.getFilesForFolder(this.accountId,a.getProxy(),t,this.connectorName,s);return{fileListPage:n.data.folderItems,hasNextPage:n.data.hasNextPage}}async GetRootFolderFromCache(){}async GetFileListFromCache(e,t){}async ParseFilesData(e){const t=[];for(const s of e){let e=!0;let i;if("folder"===s.object_type._value)i=new ConnectorPaginatedFileListProvider_ConnectorFolderInfo({proxy:s}),i.createContext(),i.setName(i.get("name"));else{i=new ConnectorPaginatedFileListProvider_ConnectorFileInfo({proxy:s}),i.createContext();const t=i.get("name");e=this.ShouldShowFile(t),e&&(i.setName(t),this.SetFileProperties(i))}e&&(i.setId(i.getProxy()._id.toString()),t.push(i))}return t}ShouldShowFile(e){const t=a.Z.getExtension(e);return!!t&&!(this.mAllowedFileExtns&&!this.mAllowedFileExtns.has(t))}SetFileProperties(e){e.setModifiedDate(new Date(e.get("modified")));let t=o.h3.OTHER;const s=e.get("content_type");if(s)t=a.Z.getAssetTypeFromMimeType(s);else{let s=e.get("ext");s||(s=a.Z.getExtension(e.get("name"))),s&&(t=a.Z.getAssetTypeForFileExt(s))}e.setType(t),e.setSize(e.get("size"))}async GetBreadcrumbsForCurrentFSD(){const e=await d.default.getInstance(),t=await e.fileAPI(),s=await t.getFileAncestors(),i=[];return void 0!==s&&s.length>0&&s.forEach(((e,t)=>{const s=new ConnectorPaginatedFileListProvider_ConnectorFolderInfo({proxy:e});s.createContext(),0===t?s.setName("/"):s.setName(s.get("name")),i.push(s)})),i}async ValidateAssetName(e){const t=await d.default.getInstance(),s=await t.connectorsAPI();try{const t=await s.isFileNameValid(this.connectorName,e);return!(!t.data||!0!==t.data)}catch(e){return!1}}}class ConnectorsProvider{constructor(){this.keySep="|"}ready(){return this.connectors?Promise.resolve(this):this.initProvider().then((()=>Promise.resolve(this)))}async initProvider(){this.connectors=new Map;const e=await d.default.getInstance(),t=await e.connectorsAPI(),s=(await t.getSystemFoldersData(!1,!1)).systemFolderData.connectors,i=await t.isOnedrivePaginationCallsEnabled();return s.forEach((e=>{this.addToConnectorMap(e.name,e.id,i)})),this}getKeyFromConnectorInfo(e,t){return e.concat(this.keySep,t)}addToConnectorMap(e,t,s){let i;i="root"===e?new DCFileListProvider:!s||"onedrive"!==e&&"onedrivebusiness"!==e?new ConnectorFilesProvider(e,t):new ConnectorPaginatedFilesProvider(e,t);const o=this.getKeyFromConnectorInfo(e,t);this.connectors.set(o,i)}getConnector(e,t){var s;const i=this.getKeyFromConnectorInfo(e,t);return null===(s=this.connectors)||void 0===s?void 0:s.get(i)}async addConnector(e,t){const s=await d.default.getInstance(),i=await s.connectorsAPI(),o=await i.isOnedrivePaginationCallsEnabled();this.addToConnectorMap(e,t,o)}}ConnectorsProvider.getInstance=i.providerUtil.getSingletonFunction(ConnectorsProvider)},DeC6:(e,t,s)=>{var i;s.d(t,{q:()=>i}),function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_COMMAND=1]="INVALID_COMMAND",e[e.INVALID_PARAMS=2]="INVALID_PARAMS",e[e.NETWORK_CALL_FAILED=3]="NETWORK_CALL_FAILED",e[e.UNKNOWN_ERROR=4]="UNKNOWN_ERROR"}(i||(i={}))},siW8:(e,t,s)=>{var i;s.d(t,{V:()=>CollabRequestCommand,v:()=>i}),function(e){e[e.BOOTSTRAP=0]="BOOTSTRAP",e[e.COLLABORATOR=1]="COLLABORATOR",e[e.INVITATION=2]="INVITATION",e[e.PUBLIC_PROFILE_SERVICE=3]="PUBLIC_PROFILE_SERVICE",e[e.PUBLIC_LINK=4]="PUBLIC_LINK",e[e.CONSENT=5]="CONSENT",e[e.PGC_SUGGESTIONS=6]="PGC_SUGGESTIONS",e[e.UNSHARE=7]="UNSHARE",e[e.MERGE_ANNOTS=8]="MERGE_ANNOTS",e[e.PGC_ACCEPT=9]="PGC_ACCEPT",e[e.LIMITS=10]="LIMITS",e[e.DELETE_COLLABORATOR=11]="DELETE_COLLABORATOR",e[e.PATCH_COLLABORATOR=12]="PATCH_COLLABORATOR",e[e.PENDING_ACCESS_REQ=13]="PENDING_ACCESS_REQ",e[e.MANAGE_ACCESS_REQ=14]="MANAGE_ACCESS_REQ"}(i||(i={}));class CollabRequestCommand{constructor(e){this.mCommand=e}get command(){return this.mCommand}networkCallName(){switch(this.mCommand){case i.BOOTSTRAP:return"BootStrap";case i.COLLABORATOR:return"Collaborator";case i.INVITATION:return"Invitation";case i.PUBLIC_PROFILE_SERVICE:return"PublicProfileService";case i.PUBLIC_LINK:return"CreateLink";case i.CONSENT:return"Consent";case i.PGC_SUGGESTIONS:case i.UNSHARE:return"PGC_Suggestions";case i.MERGE_ANNOTS:return"Merge_Annots";case i.PGC_ACCEPT:return"PGC_Accept";case i.LIMITS:return"limits";case i.DELETE_COLLABORATOR:return"DeleteCollaborators";case i.PATCH_COLLABORATOR:return"PatchCollaborators";case i.PENDING_ACCESS_REQ:return"PendingAccessRequests";case i.MANAGE_ACCESS_REQ:return"ManageAccessRequest";default:return""}return""}}}}]);
//# sourceMappingURL=private/connectors.75f2d16344b0226d6f01.map